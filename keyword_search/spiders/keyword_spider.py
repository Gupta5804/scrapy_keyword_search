import scrapy
from scrapy.linkextractors import LinkExtractor
import pandas as pd
import tldextract


#f_keywords = pd.read_excel("End Cosumer Product (1).xlsx")

class keyword_spider(scrapy.Spider):
    name = "keyword_spider"
    allowed_domains = ["yasham.in","osheaherbals.com"]
    start_urls = ["http://www.yasham.in/","https://www.osheaherbals.com/"]
    def parse(self,response):
        list_keywords = ['Acne Care Cream','Acne Care Face Wash','Acne Soap','ACNEZYL ACNE CONTROL SOAP','ACNEZYL GEL','After Shave','After Shave Cream','After Shave Lotion','Agarwood Bath Bomb','Almond Body Massage Oil','Almond Oil','Almond Saffron Cream','Aloe Moisturising Lotion','Aloe Turmeric Cream','Aloe Vera Body Lotion','Aloe Vera Cosmetics','Aloe Vera Face Wash','Aloe Vera Gel','Aloe Vera Shampoo','Aloe Vera Shaving Cream','Aloe Vera Shaving Gel','Aloevera Face Scrub','Aloevera Massage Cream','Aloevera Moisturiser','Aloevera Moisturising Soap','Aloevera Moisturizing Gel','Alovera Gel','Alovera Soap','Amla Hair Oil','Amla Oil','Anatea','Animal Feed Supplements','Anti Acne Cream','Anti Acne Facial Kit','Anti Acne Gel','Anti Acne Mint Massage Gel','Anti Acne Wipes','Anti Ageing','Anti Ageing Bleach Cream','Anti Ageing Cream','Anti Ageing Facial Kit','Anti Aging Cream','Anti Aging Gel','Anti Bacterial Neem Bleach','Anti Dandruff','Anti Pollution Face Wash','Anti Stretch Marks Cream','Anti Wrinkle / Anti Ageing Formula','Anti-Aging Serum','Antibact Wah Medicated Face Cleanser','Anti-Blemish & Pigmentation','Anti-Pigmentation & Blemishes Facial Kit','Anti-Scabies Soap','Antiseptic / Anti Bacterial Soap','Apricot Scrub','Aromatic Bath Bomb','Astaberry Hair Serum','Astringent','Ayurvedic Massage Oil','Baby Bar','Baby Cream','Baby Hair Oil','Baby Lotion','Baby Massage Oil','Baby Oil','Baby Powder','Baby Shampoo','Baby Shampoos','Baby Soap','Baby Talc','Baby Wipes','Bath and Spa','Bath Bomb','Bath Soap','Bed Bath Wipes','Bestolex-L Syrup','Bio Fertilizers','Bleach','Bleach Cream','Body Cool Powder','Body Cream','Body Grow','Body Lotion','Body Massage Oil','Body Powder','Body Scrub','Body Slimcare','Body Soap & Cleanser','Body Talc','Body Wash','Body Wash Gel','Butterball Bath Bomb','Calamine Lotion','Calcium Carbonate Based Toothpaste','CARBOFAST BALM','Chameli Hair Oil','Cleanser','Cleansers','Cleansing Face Wash','Cleansing Lotion','Cleansing Milk','CLEENHANDS','Clove Toothpaste','Coco Cinnamon Soap','Coconut & Peach Cream','Coconut Oil Bath Bomb','Cold Cream','Complete Cleanup','Concentrate','Conditioner','Cool Hair Oil','Cream','Cream Bath','Cream Scrub','Creams','Creme & Moisturisers','Cucumber Gel','Cucumber Soap','Cucumber Water','Daily Offers','DANT SHUDDHI TOOTH PASTE','DANT SHUDHI MANJAN','De Tan Cream','Detan','Diamond Bleach Cream','Diamond Facial Kit','Diamond Massage Gel','Diaper rash Cream','DICLOWIN CARBOFAST GEL','DICLOWIN PLUS','Dry Skin','Empower Mass','Emulsions','Eyeliner','Face & Body Wash with Active Beads','Face Bleach','Face Cleansing Wipes','Face Gel','Face Pack','Face Packs','Face Scrub','Face Serum','Face Wash','Face Wash & Cleansers','Face Wash Cream','Face Wash Gel','Facial Gel','Facial Kit','Facial Kits','Fairness Body Soap','Fairness Cream','Fairness Lotion','Fairness Lotion with SPF','Feminine Wipes','Fluoride Gel Toothpaste','Fluoride White Toothpaste','Foot Care','Foot Cream','Foundation Cream','Fresh Powder','Fresh Rose Toner','Frosted White Range','Fruit Bleach','Fruit Extract Shmapoo','Fruit Face wash','Fruit Facial Kit','Fruit Moisterizer Lotion','Gel Scrub','Gel Toothpaste','Gels','Glucose-D (Regular)','Grape Seed Cleansing Milk','Green Apple Shampoo','Green Apple Toner','Hair Cleanser','Hair Conditioner','Hair Cream','Hair Fall Control Lotion','Hair Food','Hair Gel','Hair Lotion','Hair Mask','Hair Nourishing Serum','Hair Oil','Hair Regrowth Pack','Hair Relaxer','Hair Removal Cream','Hair Remover','Hair Removing Cream','Hair Revitalizing','Hair Serum','Hair Shampoo','Hair Spa Kit','Hair Spa-All Hair Types','Hair Spa-Dry & Damaged Hair','Hair Spa-Weak & Frizzy Hair','Hair Styling Gel','Hair Tonic / Capsule','Hair Treatment','Hair Treatment Oil','Hair Wash Powder / Henna','Haldi Chandan Bleach Cream','Hand and Foot Cleanser','Hand and Foot Mask','Hand and Foot Massage Cream','Hand and Foot Relaxing Gel','Hand and Foot Scrub','Hand and Foot Softener','Hand Sanitizer','Hand Wash','Handmade Bath Bomb','Handwash','HEELMATE','Heena Powder','Herbal Bath Bomb','Herbal Cosmetics Contract','Herbal dog shampoo','Herbal Face Pack','Herbal Gel Toothpaste','Herbal Hair Oil','Herbal High Bath Salts','Herbal pet care product','Herbal Shampoo','Herbal skincare product','Herbal Soaps','Herbal Tea','Herbal Toothpaste','Herbals Cosmetics','Herbals Cream','Hibiscus Hair Conditioner','Homemade Bath Bomb','Instant Glow Cream','Instant Glow Gel','Jaswand Hair Gel','Kajal','Khus Soap',"Kid's Bubble Gum Toothpaste","Kid's Fruit Flavor Toothpaste","Kid's Toothpaste",'KUFMA','Lacto Bleach','LARLA CANDY','Lather Shaving Cream','Lather Shaving Gel','Lavender Bath Salts','Lavender Soap','Lavender Talcum Powder','Leave On Hair Conditioner','Lemon Face Wash','Lemon Hair Removal Cream','Lemon Soap','Lip Balm','Lip Balm(Alovera)','Lip Balm(Mixed Fruit)','Lip Balm(Rose Flavor)','Lip Guard','Lipstick','Lotion','Lotions','Luxury Soap','Mango Bleach Cream','Margosa Hand Wash','Massage Cream','Massage Gel','MEDILICE','Menthol Shaving Cream','Menthol Shaving Gel','Milk Protein Cleanrser','Mint Cleanser','Modelling Mask','Moisturising Soap','Moisturizer','Moisturizing Body Lotion','Moisturizing Cream','Mosquito Repellant  Cream','Mosquito Repellent','Mud Face Pack','Nail Paints','Natural Talcum Powder','Natural Toothpaste','Natural Wipes','Neem & Tulsi Face Wash','Neem Face Wash','Neem Gel','Neem Shampoo','Neem Soap','Neem Toothpaste','Neem Tulsi Shampoo','Non Fluoride Gel Toothpaste','Non Fluoride White Toothpaste','Nourisher','Nourishers','NutriGlow Kesh Ratan Oil','Occlusion Cream','Oily Skin','Ointments','Orange Blast Vitamin C Exfoliating Face Wash','Orange Gel','Orange Scrub','Orasore Gel','ORASORE TOOTHACHE RELIEF GEL','Oudh and Walnut','Oxygen Bleach','Papaya Anti-Pigmentation Cream','Papaya Bleach Cream','Papaya Facial Kit','Papaya Massage Cream','Papaya Skin Gel','Papaya Skin Whitening Face Wash','Papaya Soap','Pearl Creamy Shampoo','Pearl fairness Bleach Cream','Pediglow Kit','Peel Off / Mask','Perfumed Soap','Pet Care Range','Pineapple Antiaging Cream','Platinum Facial Kit','Platinum with Oxy Bleach Cream','Prickly Heat Powder','Product Name','Professional Conditioner','Professional Shampoo','Protigain PLUS','Quince Face Vitaliser','Rash Cream','Real Basil Oil Control Basil Face Wash','Rebel Lather Shaving Cream','Rebel Mens Facial Kit','Red Tooth Powder','Red Wine Toner','Regular Hair Relaxer Cream','RELICUF','Revitalizing Hair Oil','Rose Beauty Soap','Rose Hair Removal Cream','Rose Love Hydrating Toner','Rose Water','Saffron All purpose Cream','Saffron Anti Bleamish Cream','Saffron Face Wash','Saffron Massage Cream','Saffron Turmeric Anti-Blemish','Sandal and Ubtan Pack','Sandal Beauty Soap','Sandal Hair Removal Cream','Sanitizers','Scar / Blemish Removal','Scar Removing Cream','Scented Bath Bomb','Scrub','Scrub / Spray','Scrubs & Exfoliators','SELDRUF','Shampoo','Shampoo with Conditioner','Shampoos','Shaving Cream','Shea Butter Soap','Shikakai Shampoo','Shower Gel','Skin Gel','Skin Lightening','Skin Nourishers','Skin Rejunvenation Face Wash','Skin Rejuvenation Treatment Kit','Skin Whitening Bleach Cream','Skin Whitening Cream','Skin Whitening Face Wash','Skin Whitening Facial Kit','Skin Whitening Fairness Cream','Skin Whitening Kits','Skin whitening Lotion','Skin Whitening Product','Sodium Bi-Carbonate Toothpaste','Speciality Toothpaste','Sprovit','Strawberry Lip Balm','Sun Care Cream','Sun Care Gel','Sun Care Lotion','Sun Excel','Sun Protection Factor (SPF) Cream','Sun Protections','Sun Screen Wipes','Sunblock Cream','Sunscreen','Sunscreen Face Wash','Sunscreen Lotion','Super Hair Relaxer Cream','Syndet Bar','Tan Pack','Tarter Control Toothpaste','Tea Tree Body Wash','Tea Tree Oil Shaving Cream','Tea Tree Oil Shaving Gel','Toner','Toners & Lotions','Tooth Paste','Tooth Paste Gel','Tooth Powder','Toothpaste','Transparent Shampoo','Tulsi Body Soap','Turmeric Lotion','Turmeric Soap','Under Eye Care','Under Eye Cream','Under Eye Gel','Under Eye Liner','Undereye Gel','Veterinary Products','Vitadrink','VITAL FIT','Vitamin C Serum','Vitobex Syrup','Walnut Scrub','Walnut Shampoo','Wheat Germ Under Eye Cream','White Toothpaste','WINCOLD CZ','WINCOLD NASAL SPRAY','Wine Face Wash','Wine Shampoo','WINGESIC PLUS','ZEE COLD']
    
        print(response.url)
        links = LinkExtractor(allow=()).extract_links(response)
        a_list = response.css("body ::text").extract()
        b_list=[]
        for i in a_list:
            if(i.strip() is not ''):
                b_list.append(i.strip())
        #print(b_list)
        tld_list = tldextract.extract(response.url)
        for i in range(len(list_keywords)):
            
            for j in range(len(b_list)):
                if(list_keywords[i] in b_list[j]):
                    print(response.url," -->" ,list_keywords[i])
                    yield {
                        'Keyword': list_keywords[i],
                        'Domain' : tld_list.domain + "." + tld_list.suffix,
                    }
        for link in links :
            #print(link.url)
            yield scrapy.Request(link.url,callback=self.parse)
    #def second_level(self,response):
        #links = LinkExtractor(allow=()).extract_links(response)
        #for link in links:
           # print(link.url)